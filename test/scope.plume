// Test 'Variable block scope 1'
\def double[x] {#x #x}//
\def foo[x] {\double #x}//
\foo 1
// Result
1 1
// End

// Test 'Variable block scope 2'
\def bar[x] {\set[local] y 1 #x}//
\def foo {\bar #y}//
\foo
// Result
 
// End

// Test 'Variable block scope 3'
\def foo[x] {#x}//
\def bar[x] {#x}//
\foo {//
    \set x 3//
    \bar{#x}//
}//
// Result
3
// End

// Test 'Variable block scope 4'
\def foo[x] {#x}//
\def bar[x] {//
    \foo {\foo #x}//
}//
\bar a
// Result
a
// End

// Test 'Variable block scope 5'
\def id[x] {#x}//
\def foo[bar] {\id{#bar}}//
\foo{bar}
\foo{baz}
// Result
bar
baz
// End

// Test 'Variable block scope 6'
\def foo[x]{#x}\def bar[x]{#x}\bar {\foo {\setl x 0 #x}}
// Result
 0
// End

// Test '__scope 1'
\set x 10//
#{__scope.x}
// Result
10
// End

// Test 'Variable block scope 5'
\def foo[x] {#x}//
\foo {\for {i=1,4} {#i}}
// Result
1234
// End

// Test '__scope 1'
\set x 10//
#{__scope.x}
// Result
10
// End

// Test '__scope 2'
\set x 10//
\def foo {\set[local] x 5}//
\foo//
#{__scope.x}
// Result
10
// End

// Test '__scope 3'
\def foo {\set x 5 #{__scope.x}}//
\set x 10//
\foo//
// Result
 5
// End

// Test 'global 1'
\def foo {\set x 0}//
\foo//
#x//
// Result
0
// End

// Test 'global 2'
\def foo {\set x 0}//
\set x 1//
\foo//
#x//
// Result
0
// End

// Test 'Simple closure'
\def mydef[name body] {//
    \def {#name} {#body}//
}//
\mydef foo bar//
\foo
// Result
bar
// End

// Test 'Independant closures'
\def mydef[name body] {//
    \def {#name} {#body}//
}//
\mydef foo bar//
\mydef bar baz//
\foo
\bar
// Result
bar
baz
// End

// Test 'Closure in Expression'
\def create_multiplier[multiplier] {
    \def multiply_by[x] { #{x*multiplier} }//
    \multiply_by {3}//
}//
\create_multiplier {2}
// Result

     6 
// End

// Test 'Local test 1'
\script{
    local a = 4
}//
#a
// Result
4
// End

// Test 'Local test 2'
\def foo[body] {#body}//
//
\def bar {//
    \foo {//
        \script{local x=5}//
        #x//
    }//
}//
\bar
// Result
5
// End